
.PHONY: all

DIR=modice
MOD=icemodule.castcontrol

all: \
   $(DIR)/__init__.py \
  	optdefault.py

# Compile slice and create module init file
# -----------------------------------------
$(DIR):
	mkdir $(DIR)

$(DIR)/castagent_ice.py: $(DIR) castagent.ice Makefile
	slice2py --no-package --output-dir $(DIR) castagent.ice

$(DIR)/__init__.py: $(DIR) $(DIR)/castagent_ice.py Makefile
	echo "# This file is autogenerated" > $(DIR)/__init__.py
	echo "import Ice" >> $(DIR)/__init__.py
	echo "import castagent_ice" >> $(DIR)/__init__.py
	echo "try:" >> $(DIR)/__init__.py
	echo "    Ice.updateModules() # introduced in 3.4" >> $(DIR)/__init__.py
	echo "except: pass" >> $(DIR)/__init__.py
	#echo "import $(MOD).CastAgent" >> $(DIR)/__init__.py
	# echo "import $(MOD).ProcessInfo" >> $(DIR)/__init__.py


# Write default options to python
# -------------------------------
optdefault.py: default_cleanup.txt default_env.txt default_user.txt default_log4jsrv.txt Makefile
	bash ./mkdefaults.sh
