\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
% \usepackage{amsmath}

\begin{document}

\title{Evaluation of the George Year 2 System}
\author{Marko Mahniƒç\\ University of Ljubljana}
\date{2011-03-16}

\maketitle

\section{Automated testing}

In this test we are teaching the robot about shapes and colours. The automated
tutor places objects on the table one by one. When an object is on the table
the tutor first describes the shape and then the color of the object. The tutor
waits until the learning task for each description is completed. If the tutor
doesn't know an attribute, he says "hi" and waits until the robot responds.
The automated tutor is implemented with a state machine. 

\subsection{The first automated tutor}

The basic state machine is shown in figure \ref{fig:simpleStates}. There are
several problems related to this state machine. They are mostly related to the
presence of entries in various working memories.

\begin{figure}
\includegraphics[width=0.6\textwidth]{xdata/simple_states.pdf}
\label{fig:simpleStates}
\caption{Basic state machine for the automated tutor}
\end{figure}

\subsubsection*{\em opDescribe, stWaitForResponse }

The tutor describes the object that is currently in the scene and waits for the
robot to respond. Because of a too short timeout in the {\em Abducer} component
the response may never come. When the {\em Abducer} fails this way, it never
works again and the system has to be restarted. We solved this by increasing
the timeouts from $250ms$ to $5s$ in the following dialogue components:
refresolve, cint-recognizer, cint-realizer.

\subsubsection*{\em stTeaching, stWaitForResponse, stWaitForLearningTask}

VisualObjects appear and disappear while the robot is processing tutor's
instructions. When a VisualObjects disappears from the WM, the planner usually
creates a plan that references an invalid belief. Such a plan remains in a {\tt
PENDING} state. The new goals that are created afterwards are in {\tt SURFACED}
state but are never {\tt ACTIVATED}. No new plans are created.

The VisualObjects appear and disappear even though the visual subsystem is
looking at a constant image pair. The effect is most likely related to the
RANSAC algorithm in the {\em PlanePopout} component.

\subsubsection*{\em opUnloadScene, opLoadScene}

After an object has been learned, the VisualLearningTask is overwritten. This
is a signal to the tutor that he can continue with the next object. The system
presents an empty scene, waits that all VisualObjects disappear. Then it
presents a scene with the next object.

The change in the contents of the set of VisualObjects in the WM locks the
planner again: when a teaching goal for the new object appears, the planner
creates a plan that includes a belief about an object that has just
disappeared. This results in a plan in a {\tt PENDING} state.

\subsection{The improved tutor}

To improve the automated tutor we added some more states to the state machine
and most importantly we added some timeouts and pauses. The complete state
machine is shown in figure \ref{fig:allStates}. We also extended the system so
that it doesn't change the set of VisualObjects in the WM while the object
descriptions are being processed. In the state machine this is the part between
the states {\em stObjectOn} and {\em stUnloadScene}.

When the state machine comes into the state {\em stObjectOn} we wait for $5s$
so that the scene can become stable. Sometimes more than one VisualObject is
created for a presented object. In some other cases the object is not well
defined and can disappear. We want to make sure the scene is stable before we
prevent the changes of the set of VisualObjects in the WM.

In the state {\em stUnloadScene} the system waits for another $5s$ before it
replaces the scene with an empty one. Without this timeout, the planner would
lock again.

\begin{figure}
\includegraphics[width=1.0\textwidth]{xdata/states.pdf}
\label{fig:allStates}
\caption{Complete state machine for the automated tutor}
\end{figure}

With this improved state machine we can run the system for about 2 hours while
we present approximately 200 objects to the robot. After two hours the robot
just stops responding although all the components are still running. Most often
the system gets stuck in the {\em stWaitForLearningTask} state or presents new
objects without ever receiving a LearningTask.  We suspect that this might be
linked to the increasing memory requirements of the system which eventually
runs out of it.

We also made an interesting observation in the {\em stWaitForLearningTask}
state. This state is reached $2$ times while the object is on the scene. After
the tutor describes the shape, the first learning task is created after $3-5$
seconds. When the learning is complete the tutor then waits for $2s$ and
describes the color of the object.  The interesting thing about the second
LearningTask task is that it's time to appear increases with the system's
running time. Initially it is the same as for the first LearningTask. After
$4000s$ it increases to $7s$ and after $7000s$ it takes $12s$ for it to appear.
Finally the system stops resonding as described above.  The increasing time
could be related to the increasing number of messages from the planner:
``Pointer to belief xxx cannot be resolved''.

\subsection{Other crashes}

The c++ server sometimes crashes right after the message ``Planner has
attempted to overwrite an outdated WM entry. WMA:
XX:goal.scheduler:data:planner.sa.  Local version: 5.  WM version: 6''.

Some of the image pairs (less than 10 out of $1200$ in the database) cause the
components {\em PlanePopout} or {\em SOIFilter} to crash.

On rare occasions Matlab VisualRecognizer crashes when rendering the
recognition results.

\subsection{Example log}

This is a part of the log file that shows the state transitions while the robot
is learning one object (approximately $50s$).

\begin{verbatim}
[INFO gy2article: 4218.43 NEW STATE stTableEmpty]
[INFO gy2article: 4220.43 SCENE 357: 1081vl]
[INFO gy2article: 4220.44 **********]
[INFO gy2article: 4220.44 NEW STATE stWaitToAppear (to=20s)]
[INFO gy2article: 4222.45 STATE stWaitToAppear]
[INFO gy2article: 4226.47 **********]
[INFO gy2article: 4226.47 NEW STATE stObjectOn]
[INFO analyzer: blockVisualObjectUpdates enable=true]
[INFO gy2article: 4231.47 **********]
[INFO gy2article: 4231.47 NEW STATE stTeaching (to=10s)]
[INFO SOI.filter: blockProtoObjectUpdates enable=true]
[INFO gy2article: 4232.47 Tutor: this is elongated]
[INFO gy2article: 4232.47 **********]
[INFO gy2article: 4232.47 NEW STATE stWaitForResponse (to=15s)]
[INFO gy2article: 4234.48 STATE stWaitForResponse]
[INFO gy2article: 4234.48 Robot says: thank you]
[INFO gy2article: 4234.48 **********]
[INFO gy2article: 4234.48 NEW STATE stWaitForLearningTask (to=120s)]
[INFO gy2article: 4237.06 Learnig task added: [WMA: vision.sa:o2:J]]
[INFO gy2article: 4240.21 Learnig task changed: [WMA: vision.sa:o2:J]]
[INFO gy2article: 4240.21 A Learning Task was detected.]
[INFO gy2article: 4240.21 **********]
[INFO gy2article: 4240.21 NEW STATE stTeaching (to=10s)]
[INFO gy2article: 4241.22 Tutor: this is black]
[INFO gy2article: 4241.22 **********]
[INFO gy2article: 4241.22 NEW STATE stWaitForResponse (to=15s)]
[INFO gy2article: 4243.23 Robot says: thank you]
[INFO gy2article: 4243.23 **********]
[INFO gy2article: 4243.23 NEW STATE stWaitForLearningTask (to=120s)]
[INFO gy2article: 4249.55 Learnig task added: [WMA: vision.sa:p2:J]]
[INFO gy2article: 4256.04 Learnig task changed: [WMA: vision.sa:p2:J]]
[INFO gy2article: 4256.05 A Learning Task was detected.]
[INFO gy2article: 4256.05 **********]
[INFO gy2article: 4256.05 NEW STATE stTeaching (to=10s)]
[INFO gy2article: 4257.06 **********]
[INFO gy2article: 4257.06 NEW STATE stEndOfTeaching (to=15s)]
[INFO gy2article: 4257.08 **********]
[INFO gy2article: 4257.08 NEW STATE stUnloadScene]
[INFO analyzer: blockVisualObjectUpdates enable=false]
[INFO gy2article: 4262.10 SCENE: empty]
[INFO SOI.filter: blockProtoObjectUpdates enable=false]
[INFO gy2article: 4262.10 **********]
[INFO gy2article: 4262.10 NEW STATE stWaitToDisappear (to=20s)]
[INFO gy2article: 4264.11 STATE stWaitToDisappear]
[INFO gy2article: 4268.13 **********]
[INFO gy2article: 4268.13 NEW STATE stTableEmpty]
\end{verbatim}

\end{document}
