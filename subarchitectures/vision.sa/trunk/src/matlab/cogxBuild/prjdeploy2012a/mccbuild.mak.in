
.PHONY: library workdir all

all: workdir library

libname=%(prjname)s

buildtype=-T link:lib -W cpplib:$(libname)
verbose=-v
warnings=-w enable:specified_file_mismatch -w enable:repeated_file -w enable:switch_ignored -w enable:missing_lib_sentinel -w enable:demo_license

# Files (Matlab functions) to export
srcdir=%(sourceroot)s
exportfiles=\
   %(mfiles)s


# Directories to search for included scripts
includedirs=\
   %(includedirs)s


# All files are used for dependency testing
allfiles=\
   %(allfiles)s


# Ouptut of the compilation
workdir=%(builddir)s

library: $(workdir)/$(libname).so

$(workdir)/$(libname).so: $(allfiles)
	mcc $(buildtype) -d $(workdir) $(warnings) $(verbose) $(includedirs) $(exportfiles)

workdir:
	@if [ ! -d $(workdir) ]; then mkdir $(workdir); fi
