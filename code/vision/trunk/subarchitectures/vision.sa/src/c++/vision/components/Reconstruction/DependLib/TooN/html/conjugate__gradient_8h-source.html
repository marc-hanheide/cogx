<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TooN: optimization/conjugate_gradient.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>optimization/conjugate_gradient.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;TooN/optimization/brent.h&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;utility&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="keyword">namespace </span>TooN{
<a name="l00008"></a>00008 
<a name="l00009"></a>00009     <span class="keyword">namespace </span>Internal{
<a name="l00010"></a>00010     
<a name="l00011"></a>00011 
<a name="l00018"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html">00018</a>     <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> Size, <span class="keyword">typename</span> Precision, <span class="keyword">typename</span> Func&gt; <span class="keyword">struct </span><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html" title="Turn a multidimensional function in to a 1D function by specifying a point and direction...">LineSearch</a>
<a name="l00019"></a>00019     {
<a name="l00020"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#4084a7f8437993ee6894152a3ae34c0c">00020</a>         <span class="keyword">const</span> <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size, Precision&gt;</a>&amp; <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#4084a7f8437993ee6894152a3ae34c0c">start</a>; 
<a name="l00021"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#1af11fd961402f5a469d9d9d5b6da972">00021</a>         <span class="keyword">const</span> <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size, Precision&gt;</a>&amp; <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#1af11fd961402f5a469d9d9d5b6da972">direction</a>;
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#ad0eb5b5b66182e6db9a3cc550feead0">00023</a>         <span class="keyword">const</span> Func&amp; <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#ad0eb5b5b66182e6db9a3cc550feead0">f</a>;
<a name="l00024"></a>00024 
<a name="l00029"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#8c47a163545847fa216be70d4f35d527">00029</a>         <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#8c47a163545847fa216be70d4f35d527" title="Set up the line search class.">LineSearch</a>(<span class="keyword">const</span> <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size, Precision&gt;</a>&amp; s, <span class="keyword">const</span> <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size, Precision&gt;</a>&amp; d, <span class="keyword">const</span> Func&amp; func)
<a name="l00030"></a>00030         :<a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#4084a7f8437993ee6894152a3ae34c0c">start</a>(s),<a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#1af11fd961402f5a469d9d9d5b6da972">direction</a>(d),<a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#ad0eb5b5b66182e6db9a3cc550feead0">f</a>(func)
<a name="l00031"></a>00031         {}
<a name="l00032"></a>00032         
<a name="l00035"></a><a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#e19edc88e96230164ac0f8eb01aa1642">00035</a>         Precision <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#e19edc88e96230164ac0f8eb01aa1642" title="Position to evaluate function">operator()</a>(Precision x)<span class="keyword"> const</span>
<a name="l00036"></a>00036 <span class="keyword">        </span>{
<a name="l00037"></a>00037             <span class="keywordflow">return</span> <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#ad0eb5b5b66182e6db9a3cc550feead0">f</a>(<a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#4084a7f8437993ee6894152a3ae34c0c">start</a> + x * <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html#1af11fd961402f5a469d9d9d5b6da972">direction</a>); 
<a name="l00038"></a>00038         }
<a name="l00039"></a>00039     };
<a name="l00040"></a>00040     
<a name="l00050"></a><a class="code" href="group__gOptimize.html#ge31291211d124a59034f136cf2ecf939">00050</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Precision, <span class="keyword">typename</span> Func&gt; <a class="code" href="classTooN_1_1Matrix.html" title="A matrix.">Matrix&lt;3,2,Precision&gt;</a> <a class="code" href="group__gOptimize.html#ge31291211d124a59034f136cf2ecf939" title="Bracket a 1D function by searching forward from zero.">bracket_minimum_forward</a>(Precision a_val, <span class="keyword">const</span> Func&amp; func, Precision initial_lambda=1)
<a name="l00051"></a>00051     {
<a name="l00052"></a>00052         <span class="comment">//Get a, b, c to  bracket a minimum along a line</span>
<a name="l00053"></a>00053         Precision a, b, c, b_val, c_val;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         a=0;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="comment">//Search forward in steps of lambda</span>
<a name="l00058"></a>00058         Precision lambda=initial_lambda;
<a name="l00059"></a>00059         b = lambda;
<a name="l00060"></a>00060         b_val = func(b);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <span class="keywordflow">if</span>(b_val &lt; a_val) <span class="comment">//We've gone downhill, so keep searching until we go back up</span>
<a name="l00063"></a>00063         {
<a name="l00064"></a>00064             <span class="keywordflow">for</span>(;;)
<a name="l00065"></a>00065             {
<a name="l00066"></a>00066                 lambda *= 2;
<a name="l00067"></a>00067                 c = lambda;
<a name="l00068"></a>00068                 c_val = func(c);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070                 <span class="keywordflow">if</span>(c_val &gt;  b_val) <span class="comment">// we have a bracket</span>
<a name="l00071"></a>00071                     <span class="keywordflow">break</span>;
<a name="l00072"></a>00072                 <span class="keywordflow">else</span>
<a name="l00073"></a>00073                 {
<a name="l00074"></a>00074                     a = b;
<a name="l00075"></a>00075                     a_val = b_val;
<a name="l00076"></a>00076                     b=c;
<a name="l00077"></a>00077                     b_val=c_val;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079                 }
<a name="l00080"></a>00080             }
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082         <span class="keywordflow">else</span> <span class="comment">//We've overshot the minimum, so back up</span>
<a name="l00083"></a>00083         {
<a name="l00084"></a>00084             c = b;
<a name="l00085"></a>00085             c_val = b_val;
<a name="l00086"></a>00086             <span class="comment">//Here, c_val &gt; a_val</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             <span class="keywordflow">for</span>(;;)
<a name="l00089"></a>00089             {
<a name="l00090"></a>00090                 lambda *= .5;
<a name="l00091"></a>00091                 b = lambda;
<a name="l00092"></a>00092                 b_val = func(b);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094                 <span class="keywordflow">if</span>(b_val &lt; a_val)<span class="comment">// we have a bracket</span>
<a name="l00095"></a>00095                     <span class="keywordflow">break</span>;
<a name="l00096"></a>00096                 <span class="keywordflow">else</span> <span class="comment">//Contract the bracket</span>
<a name="l00097"></a>00097                 {
<a name="l00098"></a>00098                     c = b;
<a name="l00099"></a>00099                     c_val = b_val;
<a name="l00100"></a>00100                 }
<a name="l00101"></a>00101             }
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103         
<a name="l00104"></a>00104         <a class="code" href="classTooN_1_1Matrix.html" title="A matrix.">Matrix&lt;3,2&gt;</a> ret;
<a name="l00105"></a>00105         ret[0] = makeVector(a, a_val);
<a name="l00106"></a>00106         ret[1] = makeVector(b, b_val);
<a name="l00107"></a>00107         ret[2] = makeVector(c, c_val);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="keywordflow">return</span> ret;
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00159"></a><a class="code" href="structTooN_1_1ConjugateGradient.html">00159</a> <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> Size, <span class="keyword">class</span> Precision=<span class="keywordtype">double</span>&gt; <span class="keyword">struct </span><a class="code" href="structTooN_1_1ConjugateGradient.html" title="This class provides a nonlinear conjugate-gradient optimizer.">ConjugateGradient</a>
<a name="l00160"></a>00160 {
<a name="l00161"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2">00161</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>;      
<a name="l00162"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048">00162</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a>;      
<a name="l00163"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d">00163</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a>;      
<a name="l00164"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35">00164</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a>;  
<a name="l00165"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#902172040a0724ca2fb4f202091c68fa">00165</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#902172040a0724ca2fb4f202091c68fa" title="Conjugate vector searched along in the last call to iterate().">old_h</a>;  
<a name="l00166"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c">00166</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>;      
<a name="l00167"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#38fce7c6bbbe1b3062144ee09a82ceab">00167</a>     <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a> <a class="code" href="structTooN_1_1ConjugateGradient.html#38fce7c6bbbe1b3062144ee09a82ceab" title="Previous best known point (not set at construction).">old_x</a>;  
<a name="l00168"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff">00168</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a>;         
<a name="l00169"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e">00169</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e" title="Function at old_x.">old_y</a>;     
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#4b67c91bab3ada5d4c678367dac56edf">00171</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#4b67c91bab3ada5d4c678367dac56edf" title="Tolerance used to determine if the optimization is complete. Defaults to square root...">tolerance</a>; 
<a name="l00172"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#297ceefc4977c2482ae8424e135f4a39">00172</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#297ceefc4977c2482ae8424e135f4a39" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">epsilon</a>;   
<a name="l00173"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#7e189fc52b66bbeb8e2ccfb21dcbfc7e">00173</a>     <span class="keywordtype">int</span>       <a class="code" href="structTooN_1_1ConjugateGradient.html#7e189fc52b66bbeb8e2ccfb21dcbfc7e" title="Maximum number of iterations. Defaults to size.">max_iterations</a>; 
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#6e42ea9ca1b091587442a71d05442155">00175</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#6e42ea9ca1b091587442a71d05442155" title="Initial stepsize used in bracketing the minimum for the line search. Defaults to...">bracket_initial_lambda</a>;
<a name="l00176"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#9c1ddd7a1ea2d15bc1703fb8123bfa43">00176</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#9c1ddd7a1ea2d15bc1703fb8123bfa43" title="Tolerance used to determine if the linesearch is complete. Defaults to square root...">linesearch_tolerance</a>; 
<a name="l00177"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#149a40ff583b23201a633efaba1558fa">00177</a>     Precision <a class="code" href="structTooN_1_1ConjugateGradient.html#149a40ff583b23201a633efaba1558fa" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">linesearch_epsilon</a>; 
<a name="l00178"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#72949ed848ff1a572d15af1af9ea4025">00178</a>     <span class="keywordtype">int</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#72949ed848ff1a572d15af1af9ea4025" title="Maximum number of iterations in the linesearch. Defaults to 100.">linesearch_max_iterations</a>;  
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#d5097661afa3db34cf13dbebbf422e94">00180</a>     <span class="keywordtype">int</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#d5097661afa3db34cf13dbebbf422e94" title="Number of iterations performed.">iterations</a>; 
<a name="l00181"></a>00181     
<a name="l00186"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#d83f2d17587a1dcdf068d9f6a8fbffa1">00186</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Func, <span class="keyword">class</span> Deriv&gt; <a class="code" href="structTooN_1_1ConjugateGradient.html#d83f2d17587a1dcdf068d9f6a8fbffa1" title="Initialize the ConjugateGradient class with sensible values.">ConjugateGradient</a>(<span class="keyword">const</span> <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;Size&gt;</a>&amp; start, <span class="keyword">const</span> Func&amp; func, <span class="keyword">const</span> Deriv&amp; deriv)
<a name="l00187"></a>00187     : <a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>(start.<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>()),
<a name="l00188"></a>00188       <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>),<a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>),<a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>),<a class="code" href="structTooN_1_1ConjugateGradient.html#902172040a0724ca2fb4f202091c68fa" title="Conjugate vector searched along in the last call to iterate().">old_h</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>),<a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>(start),<a class="code" href="structTooN_1_1ConjugateGradient.html#38fce7c6bbbe1b3062144ee09a82ceab" title="Previous best known point (not set at construction).">old_x</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a>)
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190         <span class="keyword">using</span> std::numeric_limits;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a> = start;
<a name="l00193"></a>00193         
<a name="l00194"></a>00194         <span class="comment">//Start with the conjugate direction aligned with</span>
<a name="l00195"></a>00195         <span class="comment">//the gradient</span>
<a name="l00196"></a>00196         <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a> = deriv(<a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>);
<a name="l00197"></a>00197         <a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a> = func(<a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>);
<a name="l00200"></a>00200         <a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e" title="Function at old_x.">old_y</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <a class="code" href="structTooN_1_1ConjugateGradient.html#4b67c91bab3ada5d4c678367dac56edf" title="Tolerance used to determine if the optimization is complete. Defaults to square root...">tolerance</a> = sqrt(numeric_limits&lt;Precision&gt;::epsilon());
<a name="l00203"></a>00203         <a class="code" href="structTooN_1_1ConjugateGradient.html#297ceefc4977c2482ae8424e135f4a39" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">epsilon</a> = 1e-20;
<a name="l00204"></a>00204         <a class="code" href="structTooN_1_1ConjugateGradient.html#7e189fc52b66bbeb8e2ccfb21dcbfc7e" title="Maximum number of iterations. Defaults to size.">max_iterations</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#48c7df906a3cb0c9ee2d19c2f12dc0e2" title="Dimensionality of the space.">size</a> * 100;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <a class="code" href="structTooN_1_1ConjugateGradient.html#6e42ea9ca1b091587442a71d05442155" title="Initial stepsize used in bracketing the minimum for the line search. Defaults to...">bracket_initial_lambda</a> = 1;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <a class="code" href="structTooN_1_1ConjugateGradient.html#9c1ddd7a1ea2d15bc1703fb8123bfa43" title="Tolerance used to determine if the linesearch is complete. Defaults to square root...">linesearch_tolerance</a> =  sqrt(numeric_limits&lt;Precision&gt;::epsilon());
<a name="l00209"></a>00209         <a class="code" href="structTooN_1_1ConjugateGradient.html#149a40ff583b23201a633efaba1558fa" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">linesearch_epsilon</a> = 1e-20;
<a name="l00210"></a>00210         <a class="code" href="structTooN_1_1ConjugateGradient.html#72949ed848ff1a572d15af1af9ea4025" title="Maximum number of iterations in the linesearch. Defaults to 100.">linesearch_max_iterations</a>=100;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <a class="code" href="structTooN_1_1ConjugateGradient.html#d5097661afa3db34cf13dbebbf422e94" title="Number of iterations performed.">iterations</a>=0;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     
<a name="l00215"></a>00215 
<a name="l00227"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#592f8a5753c61e213e7013739151df32">00227</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Func&gt; <span class="keywordtype">void</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#592f8a5753c61e213e7013739151df32" title="Perform a linesearch from the current point (x) along the current conjugate vector...">find_next_point</a>(<span class="keyword">const</span> Func&amp; func)
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229         <a class="code" href="structTooN_1_1Internal_1_1LineSearch.html" title="Turn a multidimensional function in to a 1D function by specifying a point and direction...">Internal::LineSearch&lt;Size, Precision, Func&gt;</a> line(<a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>, -<a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a>, func);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">//Always search in the conjugate direction (h)</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <span class="comment">//First bracket a minimum. </span>
<a name="l00234"></a>00234         <a class="code" href="classTooN_1_1Matrix.html" title="A matrix.">Matrix&lt;3,2,Precision&gt;</a> bracket = <a class="code" href="group__gOptimize.html#ge31291211d124a59034f136cf2ecf939" title="Bracket a 1D function by searching forward from zero.">Internal::bracket_minimum_forward</a>(<a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a>, line, <a class="code" href="structTooN_1_1ConjugateGradient.html#6e42ea9ca1b091587442a71d05442155" title="Initial stepsize used in bracketing the minimum for the line search. Defaults to...">bracket_initial_lambda</a>);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="keywordtype">double</span> a = bracket[0][0];
<a name="l00237"></a>00237         <span class="keywordtype">double</span> b = bracket[1][0];
<a name="l00238"></a>00238         <span class="keywordtype">double</span> c = bracket[2][0];
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordtype">double</span> a_val = bracket[0][1];
<a name="l00241"></a>00241         <span class="keywordtype">double</span> b_val = bracket[1][1];
<a name="l00242"></a>00242         <span class="keywordtype">double</span> c_val = bracket[2][1];
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">//We should have a bracket here</span>
<a name="l00245"></a>00245         assert(a &lt; b &amp;&amp; b &lt; c);
<a name="l00246"></a>00246         assert(a_val &gt; b_val &amp;&amp; b_val &lt; c_val);
<a name="l00247"></a>00247         
<a name="l00248"></a>00248         <span class="comment">//Find the real minimum</span>
<a name="l00249"></a>00249         <a class="code" href="structTooN_1_1Vector.html" title="A vector.">Vector&lt;2, Precision&gt;</a>  m = <a class="code" href="group__gOptimize.html#gccb6109f6dcb1ab258a2d9df84307ae4" title="brent_line_search performs Brent&amp;#39;s golden section/quadratic interpolation search...">brent_line_search</a>(a, b, c, b_val, line, <a class="code" href="structTooN_1_1ConjugateGradient.html#72949ed848ff1a572d15af1af9ea4025" title="Maximum number of iterations in the linesearch. Defaults to 100.">linesearch_max_iterations</a>, <a class="code" href="structTooN_1_1ConjugateGradient.html#9c1ddd7a1ea2d15bc1703fb8123bfa43" title="Tolerance used to determine if the linesearch is complete. Defaults to square root...">linesearch_tolerance</a>, <a class="code" href="structTooN_1_1ConjugateGradient.html#149a40ff583b23201a633efaba1558fa" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">linesearch_epsilon</a>); 
<a name="l00250"></a>00250     
<a name="l00251"></a>00251         assert(m[0] &gt;= a &amp;&amp; m[0] &lt;= c);
<a name="l00252"></a>00252         assert(m[1] &lt;= b_val);
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         <span class="comment">//Update the current position and value</span>
<a name="l00255"></a>00255         <a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e" title="Function at old_x.">old_y</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a>;
<a name="l00256"></a>00256         <a class="code" href="structTooN_1_1ConjugateGradient.html#38fce7c6bbbe1b3062144ee09a82ceab" title="Previous best known point (not set at construction).">old_x</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a> -= m[0] * <a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a>;
<a name="l00259"></a>00259         <a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a> = m[1];
<a name="l00260"></a>00260         
<a name="l00261"></a>00261         <a class="code" href="structTooN_1_1ConjugateGradient.html#d5097661afa3db34cf13dbebbf422e94" title="Number of iterations performed.">iterations</a>++;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     
<a name="l00266"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#a28a84db186a9f31cd3ca447a68daa9d">00266</a>     <span class="keywordtype">bool</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#a28a84db186a9f31cd3ca447a68daa9d" title="Check to see it iteration should stop.">finished</a>()
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268         <span class="keyword">using</span> std::abs;
<a name="l00269"></a>00269         <span class="keywordflow">return</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#d5097661afa3db34cf13dbebbf422e94" title="Number of iterations performed.">iterations</a> &gt; <a class="code" href="structTooN_1_1ConjugateGradient.html#7e189fc52b66bbeb8e2ccfb21dcbfc7e" title="Maximum number of iterations. Defaults to size.">max_iterations</a> || 2*abs(<a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a> - <a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e" title="Function at old_x.">old_y</a>) &lt;= <a class="code" href="structTooN_1_1ConjugateGradient.html#4b67c91bab3ada5d4c678367dac56edf" title="Tolerance used to determine if the optimization is complete. Defaults to square root...">tolerance</a> * (abs(<a class="code" href="structTooN_1_1ConjugateGradient.html#3ed65576e43a54585cc5452dd06ba9ff" title="Function at .">y</a>) + abs(<a class="code" href="structTooN_1_1ConjugateGradient.html#72a0ad749571eda5b697859a9d8e776e" title="Function at old_x.">old_y</a>) + <a class="code" href="structTooN_1_1ConjugateGradient.html#297ceefc4977c2482ae8424e135f4a39" title="Additive term in tolerance to prevent excessive iterations if . Known as ZEPS in...">epsilon</a>);
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271     
<a name="l00279"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#187676961882ae2bbf11bbd0e242a551">00279</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Deriv&gt; <span class="keywordtype">void</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#187676961882ae2bbf11bbd0e242a551" title="After an iteration, update the gradient and conjugate using the Polak-Ribiere equations...">update_vectors_PR</a>(<span class="keyword">const</span> Deriv&amp; deriv)
<a name="l00280"></a>00280     {
<a name="l00281"></a>00281         <span class="comment">//Update the position, gradient and conjugate directions</span>
<a name="l00282"></a>00282         <a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a>;
<a name="l00283"></a>00283         <a class="code" href="structTooN_1_1ConjugateGradient.html#902172040a0724ca2fb4f202091c68fa" title="Conjugate vector searched along in the last call to iterate().">old_h</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a>;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285         <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a> = deriv(<a class="code" href="structTooN_1_1ConjugateGradient.html#ab33cc9ce737aa2f26008cf053c33f3c" title="Current position (best known point).">x</a>);
<a name="l00286"></a>00286         <span class="comment">//Precision gamma = (g * g - oldg*g)/(oldg * oldg);</span>
<a name="l00287"></a>00287         Precision gamma = (<a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a> * <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a> - <a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a>*<a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a>)/(<a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a> * <a class="code" href="structTooN_1_1ConjugateGradient.html#9b94f707b1c47e1d6d34eb7570663d35" title="Gradient vector used to compute $h$ in the last call to iterate().">old_g</a>);
<a name="l00288"></a>00288         <a class="code" href="structTooN_1_1ConjugateGradient.html#8e265260a4d94682f6c8d2be7c0ade6d" title="Conjugate vector to be searched along in the next call to iterate().">h</a> = <a class="code" href="structTooN_1_1ConjugateGradient.html#bb924d577658cbf563e5b2f2c6e33048" title="Gradient vector used by the next call to iterate().">g</a> + gamma * <a class="code" href="structTooN_1_1ConjugateGradient.html#902172040a0724ca2fb4f202091c68fa" title="Conjugate vector searched along in the last call to iterate().">old_h</a>;
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290     
<a name="l00308"></a><a class="code" href="structTooN_1_1ConjugateGradient.html#a8bb78d945b4627f9062a936e9629d57">00308</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Func, <span class="keyword">class</span> Deriv&gt; <span class="keywordtype">bool</span> <a class="code" href="structTooN_1_1ConjugateGradient.html#a8bb78d945b4627f9062a936e9629d57" title="Use this function to iterate over the optimization.">iterate</a>(<span class="keyword">const</span> Func&amp; func, <span class="keyword">const</span> Deriv&amp; deriv)
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310         <a class="code" href="structTooN_1_1ConjugateGradient.html#592f8a5753c61e213e7013739151df32" title="Perform a linesearch from the current point (x) along the current conjugate vector...">find_next_point</a>(func);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312         <span class="keywordflow">if</span>(!<a class="code" href="structTooN_1_1ConjugateGradient.html#a28a84db186a9f31cd3ca447a68daa9d" title="Check to see it iteration should stop.">finished</a>())
<a name="l00313"></a>00313         {
<a name="l00314"></a>00314             <a class="code" href="structTooN_1_1ConjugateGradient.html#187676961882ae2bbf11bbd0e242a551" title="After an iteration, update the gradient and conjugate using the Polak-Ribiere equations...">update_vectors_PR</a>(deriv);
<a name="l00315"></a>00315             <span class="keywordflow">return</span> 1;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317         <span class="keywordflow">else</span>
<a name="l00318"></a>00318             <span class="keywordflow">return</span> 0;
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 };
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Thu May 7 20:28:40 2009 for TooN by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
