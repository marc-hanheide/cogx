<project name="Abducer Java Utility Library" default="jar" basedir=".">

	<property name="build.sysclasspath" value="last" />
	<property name="abducer.dir" value=".." />

	<property name="debug" value="true" />

	<path id="build.classpath">
		<fileset dir="${jar.dir}" includes="*.jar" />
		<pathelement path="${ice.jar}" />
	</path>

	<property name="src.dir" value="./src" />
	<property name="slice.dir" value="${abducer.dir}/slice" />

	<property name="generated.dir" value="./src-generated" />
	<property name="localjar.dir" value="./jar" />
	<property name="output.dir" value="./classes" />

	<property name="javadoc.dir" value="${abducer.dir}/doc/javadoc"/>

	<taskdef name="slice2java" classname="Slice2JavaTask" />

	<target name="prepare" description="prepare output directories">
		<mkdir dir="${generated.dir}" />
		<mkdir dir="${output.dir}" />
		<mkdir dir="${localjar.dir}" />
	</target>

	<target name="expandlibs" depends="prepare">
		<copy todir="${jar.dir}" file="./lib/log4j-1.2.jar" />
	</target>

	<target name="slice" depends="prepare" description="generate sources from Slice">
		<slice2java tie="true" outputdir="${generated.dir}">
			<fileset dir="${slice.dir}" includes="abducer.ice" />
			<includepath>
				<pathelement path="${slice.dir}" />
			</includepath>
		</slice2java>
	</target>

	<target name="compile-slice" depends="slice" description="compile autogenerated classes">
		<javac srcdir="${generated.dir}" destdir="${output.dir}" debug="${debug}"
				deprecation="${deprecation}" optimize="${optimize}"
				debuglevel="lines,vars,source">
			<classpath refid="build.classpath" />
		</javac>
	</target>

	<target name="compile" depends="expandlibs,compile-slice,compile-src"
			description="compile all" />


	<target name="compile-src" depends="slice"
			description="compile the production code">
		<javac srcdir="${src.dir}" destdir="${output.dir}" debug="${debug}"
				deprecation="${deprecation}" optimize="${optimize}"
				debuglevel="lines,vars,source">
			<classpath refid="build.classpath" />
		</javac>
	</target>

	<target name="doc" depends="slice">
		<javadoc
				destdir="${javadoc.dir}"
				author="true"
				version="true"
				use="true"
				windowtitle="Abducer Java API">

			<fileset dir="${src.dir}" defaultexcludes="yes">
			</fileset>

			<fileset dir="${generated.dir}" defaultexcludes="yes">
			</fileset>

			<doctitle><![CDATA[<h1>Abducer Java Utility Library</h1>]]></doctitle>
			<bottom><![CDATA[<i>Copyright &#169; 2009-2011 DFKI GmbH. All Rights Reserved.</i>]]></bottom>
		</javadoc>
	</target>

	<target name="jar" depends="compile">
		<jar destfile="${localjar.dir}/abducer-util.jar"
				basedir ="${output.dir}" />
	</target>

	<target name="clean">
		<delete dir="${generated.dir}"/>
		<delete dir="${output.dir}"/>
		<delete dir="${localjar.dir}"/>
	</target>

</project>
