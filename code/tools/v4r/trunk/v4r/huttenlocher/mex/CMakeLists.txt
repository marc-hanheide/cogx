SET(V4R_MEX_HUTTENLOCHER 0 CACHE BOOL "huttenlocher for matlab" )
IF(V4R_MEX_HUTTENLOCHER)

SET(MEX_EXTENSION mexglx)
INCLUDE(FindMatlab)
FIND_PROGRAM(MEX_COMPILER mex)

IF(MEX_COMPILER)

EXECUTE_PROCESS( COMMAND pkg-config --cflags opencv OUTPUT_VARIABLE MEX_OPENCV_INCLUDE_PATH)
EXECUTE_PROCESS( COMMAND pkg-config --libs opencv OUTPUT_VARIABLE MEX_OPENCV_LIBRARIES)

SET(MEX_OPENCV
  ${MEX_OPENCV_INCLUDE_PATH}
  ${MEX_OPENCV_LIBRARIES})

MESSAGE( STATUS "MEX_OPENCV_INCLUDE_PATH   : ${MEX_OPENCV_INCLUDE_PATH}")
MESSAGE( STATUS "MEX_OPENCV_LIBRARIES      : ${MEX_OPENCV_LIBRARIES}")
STRING(REGEX REPLACE "\n" "" MEX_OPENCV "${MEX_OPENCV}" )

SET(MEX_HUTTENLOCHER_LIBRARIES
  -L${LIBRARY_OUTPUT_PATH}
  -lv4rhl )

MACRO (CREATE_MEX _name)
	ADD_CUSTOM_TARGET(${_name} 
	ALL echo
	DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/${_name}.${MEX_EXTENSION}
	)
	ADD_CUSTOM_COMMAND(
	OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/${_name}.${MEX_EXTENSION} 
	COMMAND   ${MEX_COMPILER} ${CMAKE_CURRENT_SOURCE_DIR}/${_name}.cpp 
  ARGS      -outdir ${CMAKE_CURRENT_SOURCE_DIR} -O -I${HUTTENLOCHER_DIR} ${MEX_OPENCV} ${MEX_HUTTENLOCHER_LIBRARIES}
	COMMENT   "MEX"
	)
ENDMACRO (CREATE_MEX _name)


CREATE_MEX (mex_huttenlocher )
ENDIF(MEX_COMPILER)

ENDIF(V4R_MEX_HUTTENLOCHER)
